<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>[Part two &amp;#8211; Unit Testing] Build a Decentralized Domain Name System (DDNS) on top of Ethereum - hack</title><meta name="gridsome:hash" content="adb0b35dde5de245c8df8d61d884df922ff1bb9b"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.19"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Blockchain &amp; DLT Solutions"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:400,400i,700%7CRoboto:700&amp;display=swap"><link data-vue-tag="ssr" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous"><link rel="preload" href="/assets/css/0.styles.1eb650f2.css" as="style"><link rel="preload" href="/assets/js/app.7015662a.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-post-vue.c47e6f40.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.5fdc8a63.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.715ba3ee.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.0f106ca2.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.51484801.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-author-vue.35662bd3.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.77c20d72.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-page-vue.faeebe5b.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.a1916cbc.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--blog-vue~page--src--templates--word-press-author-vue~page--src--templates-~9ca311c5.fca845c5.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-category-vue.513b06a2.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-post-tag-vue.79b14ebe.js"><link rel="stylesheet" href="/assets/css/0.styles.1eb650f2.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="body-bg"><div class="container"><header class="py-2 sticky-top header" data-v-3125ca30><nav id="nav-header" class="navbar p-1 navbar-light navbar-expand-lg" data-v-3125ca30><div class="navbar-brand" data-v-3125ca30><a href="/" target="_self" class="navbar-brand font-family-headings router-link-active" data-v-3125ca30><img src="/assets/img/hack-logo.a62cc95d.png" alt="hack-logo" height="80" data-v-3125ca30></a></div><button type="button" aria-label="Toggle navigation" aria-controls="nav-collapse" aria-expanded="false" class="navbar-toggler" data-v-3125ca30><span class="navbar-toggler-icon"></span></button><div id="nav-collapse" class="navbar-collapse collapse" style="display:none;" data-v-3125ca30><ul class="navbar-nav ml-auto align-middle" data-v-3125ca30><li class="nav-item text-primary" data-v-3125ca30><a href="/#home" target="_self" class="nav-link" data-v-3125ca30>Home</a></li><li class="nav-item b-nav-dropdown dropdown dropper" data-v-3125ca30><a aria-haspopup="true" aria-expanded="false" target="_self" href="#" class="nav-link dropdown-toggle"><span>Services</span></a><ul tabindex="-1" class="dropdown-menu dropdown-menu-right"><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/dlt-blockchain-development-services/blockchain-software-development" class="dropdown-item">Blockchain Development</a></li><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/dlt-blockchain-development-services/smart-contracts-development" class="dropdown-item">Smart Contracts Development</a></li><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/dlt-blockchain-development-services/smart-contract-audits" class="dropdown-item">Smart Contract Audits</a></li><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/dlt-blockchain-development-services/blockchain-consulting" class="dropdown-item">Consulting</a></li><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/dlt-blockchain-development-services/decentralized-applications-development" class="dropdown-item">Decentralized application (dApp) development</a></li><li role="presentation" data-v-3125ca30><hr role="separator" aria-orientation="horizontal" class="dropdown-divider" data-v-3125ca30></li><li role="presentation" data-v-3125ca30><a role="menuitem" target="_self" href="/#services" class="dropdown-item">All services</a></li></ul></li><li class="nav-item text-primary" data-v-3125ca30><a href="/#about" target="_self" class="nav-link" data-v-3125ca30>About us</a></li><li class="nav-item" data-v-3125ca30><a href="/blog" target="_self" class="nav-link active" data-v-3125ca30>Blog</a></li><li class="nav-item" data-v-3125ca30><a href="/#contact" target="_self" class="nav-link" data-v-3125ca30><span class="contact" data-v-3125ca30>Get in touch</span></a></li></ul></div></nav></header><!----><main><div class="row align-items-start"><main class="bg-white p-0 rounded shadow-lg col-lg-12 col-12"><div class="overflow-hidden p-4 p-sm-5"><article class="row"><div data-first="[" class="meta-data py-md-5 text-center position-relative d-flex col-md-3"><div class="mx-auto mb-2 position-relative"><span class="post-date font-weight-bold">29 Dec 2018</span><i class="d-none d-md-block">in:</i><ul class="list-inline mb-0"><li class="list-inline-item m-0"><a href="/category/tutorials/" class="text-uppercase font-weight-bold mx-1">Tutorials</a><!----></li></ul><div><i>by: </i><a href="/author/milen/" class="font-weight-bold">
          Milen Radkov
        </a></div></div></div><div class="mb-5 py-md-5 col"><header class="mb-4"><h1 class="text-break">[Part two &#8211; Unit Testing] Build a Decentralized Domain Name System (DDNS) on top of Ethereum</h1><img src="https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack.jpg" alt="Unit Testing Decentralized Domain Name System" width="1200" class="mt-4 img-fluid"></header><div class="post-content text-break">
<p class="has-drop-cap">Whether you develop software yourself or <a href="https://hack.bg/#contact">hire developers</a> to build it for you, you expect them to do everything necessary, so you can get functional and bug-free software. Sometimes, however, doing the right thing takes additional time, which is often being skipped due to all the deadlines, budget or some other reason.</p>



<p>In blockchain development as in the traditional software development, unit testing reduces the number of bugs, making it &#8220;a must&#8221; to effective software development. </p>



<p>In this article, we are going to look at this type of testing &#8211; unit testing &#8211; and why you should not cut corners and skip this part of the software development cycle.</p>



<hr class="wp-block-separator"/>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack-1024x683.jpg" alt="Unit Testing Decentralized Domain Name System" class="wp-image-386" srcset="https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack-1024x683.jpg 1024w, https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack-300x200.jpg 300w, https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack-768x512.jpg 768w, https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack-864x576.jpg 864w, https://hack.bg/wp-content/uploads/2018/12/unit-testing-decentralized-domain-name-system-hack.jpg 1200w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>Unit Testing Decentralized Domain Name System</figcaption></figure></div>



<hr class="wp-block-separator"/>



<p>This is part two of our series of building decentralized domain name system on top of <a href="https://ethereum.org/">Ethereum</a>, where we&#8217;ll get familiar with good practices and techniques during <g class="gr_ gr_34 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="34" data-gr-id="34">unit</g> testing process and deployment of a decentralized application (<g class="gr_ gr_14 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="14" data-gr-id="14">dApp</g>) development lifecycle.</p>



<p>In the first part, we developed a decentralized application consisted of Ethereum smart contracts, that are acting as a decentralized domain name system. So, at this point, a user should be able to buy, renew, edit and transfer a domain name according to our <g class="gr_ gr_191 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="191" data-gr-id="191">dApp&#8217;s</g> logic. If you haven&#8217;t checked out <a href="https://hack.bg/blog/tutorials/part-one-smart-contracts-build-a-decentralized-domain-name-system-ddns-on-top-of-ethereum/">the first part of our tutorial</a> yet &#8211; this is probably the time to do so.</p>



<p>To sum up:</p>



<ul><li>Unit tests are code that tests your contract code</li><li>It executes your contract with predefined function calls (test cases)</li><li>It compares the result of the execution with the expected result for this case</li></ul>



<h2>Tooling</h2>



<p>The most popular and commonly used way of creating unit tests for Ethereum smart contracts written in Solidity is by using the following tool-set.</p>



<ol><li><a href="https://truffleframework.com/truffle">Truffle</a> &#8211; is the most popular development framework for Ethereum. <ul><li>Built-in smart contract compilation, linking, deployment and binary management.</li><li>Automated contract testing for rapid development.</li><li>Scriptable, extensible deployment &amp; migrations framework.</li><li>Network management for deploying to any number of public &amp; private networks.</li><li>Package management with EthPM &amp; NPM, using the <a href="https://github.com/ethereum/EIPs/issues/190">ERC190</a> standard.</li><li>Interactive console for direct contract communication.</li><li>Configurable build pipeline with support for tight integration.</li><li>External script runner that executes scripts within a Truffle environment. </li></ul></li><li><a href="https://truffleframework.com/ganache">Ganache</a> &#8211; lets you quickly fire up a personal Ethereum blockchain which you can use to run tests, execute commands, and inspect state while controlling how the chain operates.</li></ol>



<hr class="wp-block-separator"/>



<p>Without further due, let&#8217;s jump into setting up our project and environment for unit testing.<br></p>



<p>First if we haven&#8217;t already, we need to install Truffle globally (-g)</p>



<pre class="wp-block-preformatted"><code>npm install -g truffle</code></pre>



<p>and Ganache &#8211; It is available as both a desktop application as well as a command-line tool (formerly known as the TestRPC). For the purpose of our tutorial we are going to use the command-line tool.</p>



<pre class="wp-block-preformatted"><code>npm install -g ganache-cli</code></pre>



<p><g class="gr_ gr_5 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="5" data-gr-id="5">Okey</g>, now we are good to go. There is a tutorial for using truffle for <g class="gr_ gr_37 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="37" data-gr-id="37">unit</g> testing in their website <a href="https://truffleframework.com/tutorials/testing-for-throws-in-solidity-tests">here</a>, but <g class="gr_ gr_18 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="18" data-gr-id="18"><code>throw</code></g> function used there is now deprecated and replaced by <code>revert()</code>, <code>require()</code> and <code>assert()</code>. So it will be somewhat helpful if you know how the last work.</p>



<p>Nevertheless, let us verify our knowledge by a quick lookup at the <a href="https://solidity.readthedocs.io/en/develop/control-structures.html#error-handling-assert-require-revert-and-exceptions">Solidity documentation</a>:</p>



<blockquote class="wp-block-quote"><p>Error handling: Assert, Require, Revert and Exceptions<br> Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the state in the current call (and all its sub-calls) and also flag an error to the caller. The convenience functions <code>assert</code> and <code>require</code> can be used to check for conditions and throw an exception if the condition is not met. The <code>assert</code> function should only be used to test for internal errors, and to check invariants. The <code>require</code>  function should be used to ensure valid conditions, such as inputs, or  contract state variables are met, or to validate return values from  calls to external contracts. If used properly, analysis tools can evaluate your contract to identify  the conditions and function calls which will reach a failing <code>assert</code>.  Properly functioning code should never reach a failing assert  statement; if this happens there is a bug in your contract which you  should fix.<br> There are two other ways to trigger exceptions: The <code>revert</code> function can be used to flag an error and revert the current call. It is possible to provide a string message containing details about the error that will be passed back to the caller.</p><cite>Solidity documentation</cite></blockquote>



<h2>Project initialization</h2>



<p class="note"><strong>Note:</strong> If you have initialized your project with <code>truffle init</code> you can skip this part.</p>



<p>In the first part we covered mainly the code, but not the environment, IDE and project setup, but for our tests to run properly we will need that set.</p>



<p>Setting up a new truffle project:</p>



<pre class="wp-block-preformatted"><code>truffle init</code></pre>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/decentralized-dns-truffle-init.png" alt="Decentralized Domain Name System - project initialization" class="wp-image-345" srcset="https://hack.bg/wp-content/uploads/2018/12/decentralized-dns-truffle-init.png 682w, https://hack.bg/wp-content/uploads/2018/12/decentralized-dns-truffle-init-300x248.png 300w" sizes="(max-width: 682px) 100vw, 682px" /><figcaption>Decentralized Domain Name System &#8211; project initialization</figcaption></figure></div>



<p>As you notice after project initialization Truffe adds some files into our project directory: </p>



<ul><li><code>./contracts</code> &#8211; directory where our smart contracts should be stored.</li><li><code>./migrations</code> &#8211; directory for placing our migrations scripts.</li><li><code>./test</code> &#8211; directory for test files for testing our decentralized application.</li><li><code>./truffle-config.js</code> &#8211; this is our project&#8217;s truffle configuration file.</li></ul>



<h2>Writing Unit Tests</h2>



<p>Writing unit tests is a must for decentralized applications development life-cycle, so we can be sure the application works <strong>the way it is designed to</strong>.</p>



<p>So Truffle gives us couple of possible options to write tests &#8211; in JavaScript, TypeScript (testing your contract via web3) or Solidity (testing your contract from another contract). In our tutorial we will cover unit testing with JavaScript which its the most adopted way of doing so in my opinion.</p>



<p>All contracts in truffle&#8217;s contracts folder are accessible and are published automatically for our tests. Our unit tests should be placed in the <code>./test</code> folder and must end with <code>.js</code> extension so it can be recognized as an automated test by <a href="https://mochajs.org/">Mocha</a> framework which Truffle uses for testing. For the assertions Truffle uses <a href="https://www.chaijs.com/">Chai</a>, which you may or may not be familiar with.</p>



<blockquote class="wp-block-quote is-style-default"><p>Chai is a BDD / TDD assertion library for <a href="http://nodejs.org">node</a> and can be paired with any javascript testing framework.</p><cite>Chaijs</cite></blockquote>



<p>Truffle&#8217;s got well structured, extensive <a href="https://truffleframework.com/docs/truffle/overview">documentation</a> which you can read upon and get familiar with, if you want to.</p>



<hr class="wp-block-separator"/>



<figure class="wp-block-pullquote is-style-default"><blockquote><p>So starting with the structure of a unit test case.</p></blockquote></figure>



<p>A test is a call of a contract function with predefined (hard-coded) arguments and a predefined expected output. And the expected output should be the correct way the contract functions.</p>



<blockquote class="wp-block-quote"><p>What makes Truffle tests different from that of Mocha is the <code>contract()</code> function: This function works exactly like <code>describe()</code> except it enables Truffle&#8217;s <a href="https://truffleframework.com/docs/truffle/testing/testing-your-contracts#clean-room-environment">clean-room features</a>.</p><cite>Truffle documentation</cite></blockquote>



<p>Each group of tests is ran with clean contract state, meaning that for every test new contract is being published.</p>



<p>Here is how our DDNSService.test.js should look like:</p>



<pre><code>

const DDNSService = artifacts.require('../contracts/DDNSService.sol')

// place helpers here

contract('DDNSService', ([owner, wallet, anotherAccount]) =&gt; {
	let contractInstance;
	let events = [];

	before(() =&gt; {
		web3.eth.defaultAccount = owner;
	});

	beforeEach(async () =&gt; {
		contractInstance = await DDNSService.new();
	});

	afterEach(() =&gt; {
		if (events.length) {
			events.forEach((ev) =&gt; {
				ev.stopWatching();
			});

			events = [];
		}
    });
  
    it("BYTES_DEFAULT_VALUE constant Should have exact value", async () =&gt; {
		// Arrange

		// Act
		const result = await contractInstance.BYTES_DEFAULT_VALUE();

		// Assert
		assert.equal(result, '0x00');
   });

... more tests 

});</code></pre>



<p><br></p>



<p>In the code above, we&#8217;ve set our contract instance and written the first test, which tests whether the <code>BYTES_DEFAULT_VALUE</code> constant in our smart contract is set to <code>0x00</code>.</p>



<p>Here is a more sophisticated example &#8211; <i>register Should throw when the sent funds are insufficient</i> &#8211; we are getting the price for the passed domain name, IP, TLD, substract 1 via <code>.minus(1)</code> so we can have a smaller than the actual domain price saved in our <code>currentPrice</code> constant, which we pass as value argument for the domain register via the <code>register()</code> function afterwards. Then we assert whether the call failed with <code>assertRevert</code>.</p>



<pre><code>it("register Should throw when the sent funds are insufficient", async () =&gt; {
		// Arrange
		const domainName = "milenradkov";
		const ip = "127.0.0.1";
		const topLevelDomain = "com";
		const currentPrice = (await contractInstance.getPrice(domainName)).minus(1);
		// Act
		const result = contractInstance.register(domainName, topLevelDomain, ip, { from: anotherAccount, value: currentPrice });
		// Assert
		await assertRevert(result);
});</code></pre>



<p>Unit tests in truffle can be written <g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="4" data-gr-id="4">using </g><code>.then</code><g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="4" data-gr-id="4"> </g><g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="5" data-gr-id="5"><g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="4" data-gr-id="4">or</g> </g><code>await/async</code><g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="5" data-gr-id="5"> style</g>, so it&#8217;s up to the developer&#8217;s preference how to write them.</p>



<hr class="wp-block-separator"/>



<p>Testing the contract against the cases we&#8217;ve coded is really simple:</p>



<p>1. Start <code>ganache-cli</code> in separate terminal/cmd &#8211; this will instantiate our private blockchain which we are going to use for tests.</p>



<pre><code>ganache-cli</code></pre>



<p>2. Run <code>truffle test</code> command from the project directory.</p>



<pre><code>truffle test</code></pre>



<hr class="wp-block-separator"/>



<p>As you&#8217;ve probably noticed already, we are using the so known AAA (<a href="http://wiki.c2.com/?ArrangeActAssert">Arrange Act Assert</a>) pattern for our unit tests &#8211; it&#8217;s always good to stick to well-formatted code and best practices when you are coding for lots of well-known reasons.</p>



<blockquote class="wp-block-quote"><p>&#8220;Arrange-Act-Assert&#8221;a pattern for arranging and formatting code in <a href="http://wiki.c2.com/?UnitTest">UnitTest</a> methods: </p><p>Each method should group these functional sections, separated by blank lines: </p><ol><li> <strong>Arrange</strong> all necessary preconditions and inputs.
</li><li> <strong>Act</strong> on the object or method under test.
</li><li> <strong>Assert</strong> that the expected results have occurred.
</li></ol><cite>Arrange-Act-Assert pattern unit test</cite></blockquote>



<h3>Helpers</h3>



<p>We are going to need some predefined helpers for some of our next test cases, which names are speaking for what they actually do respectively.</p>



<pre><code>
//helpers
const assertRevert = require('./utils/assertRevert');
const watchEvent = require('./utils/watchEvent');
const constants = require('./utils/constants');
const increaseTime = require('./utils/increaseTime');</code></pre>



<h3>Coverage</h3>



<p>Following this logic here are all the test cases covering most of the edge cases of our decentralized domain name service smart contract functions.</p>



<figure><script src="https://gist.github.com/mradkov/2470c611a7a3d0be1508ead681929a90.js"></script><figcaption></figcaption></figure>



<hr class="wp-block-separator"/>



<h2>Running tests</h2>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/ganache_cli.png" alt="instantiate ganache-cli" class="wp-image-376" srcset="https://hack.bg/wp-content/uploads/2018/12/ganache_cli.png 799w, https://hack.bg/wp-content/uploads/2018/12/ganache_cli-300x202.png 300w, https://hack.bg/wp-content/uploads/2018/12/ganache_cli-768x516.png 768w" sizes="(max-width: 799px) 100vw, 799px" /><figcaption>instantiate ganache-cli</figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/ganache_cli_running.png" alt="ganache-cli running" class="wp-image-377" srcset="https://hack.bg/wp-content/uploads/2018/12/ganache_cli_running.png 799w, https://hack.bg/wp-content/uploads/2018/12/ganache_cli_running-300x202.png 300w, https://hack.bg/wp-content/uploads/2018/12/ganache_cli_running-768x516.png 768w" sizes="(max-width: 799px) 100vw, 799px" /><figcaption>ganache-cli running</figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/truffle_test.png" alt="truffle test - Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum" class="wp-image-378" srcset="https://hack.bg/wp-content/uploads/2018/12/truffle_test.png 843w, https://hack.bg/wp-content/uploads/2018/12/truffle_test-300x215.png 300w, https://hack.bg/wp-content/uploads/2018/12/truffle_test-768x550.png 768w, https://hack.bg/wp-content/uploads/2018/12/truffle_test-804x576.png 804w" sizes="(max-width: 843px) 100vw, 843px" /><figcaption>truffle test &#8211; Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum</figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://hack.bg/wp-content/uploads/2018/12/truffle_test_passing.png" alt="Truffle Test passing - Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum" class="wp-image-379" srcset="https://hack.bg/wp-content/uploads/2018/12/truffle_test_passing.png 843w, https://hack.bg/wp-content/uploads/2018/12/truffle_test_passing-300x215.png 300w, https://hack.bg/wp-content/uploads/2018/12/truffle_test_passing-768x550.png 768w, https://hack.bg/wp-content/uploads/2018/12/truffle_test_passing-804x576.png 804w" sizes="(max-width: 843px) 100vw, 843px" /><figcaption>Truffle Test passing &#8211; Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum</figcaption></figure></div>



<h2>Conclusion</h2>



<p>Unit testing are important when developing smart contracts on Ethereum, as there are lots of vulnerabilities or edge cases that can lead to security flaws or value (ETH) theft.</p>



<p>In the next few parts we will set up code coverage and continuous integration with Travis CI. </p>



<p>Also we will look deeper in to the security part of development and testing, tips and tricks and more, so <a href="http://eepurl.com/gcxyRj">stay tuned.</a></p>



<h3><strong>Useful links</strong></h3>



<ul><li><a href="https://hack.bg/blog/tutorials/part-one-smart-contracts-build-a-decentralized-domain-name-system-ddns-on-top-of-ethereum/">Part one &#8211; Smart Contracts &#8211; Build Decentralized Domain Name System on top of Ethereum</a></li><li>Part two &#8211; Unit Testing &#8211; [you are here] ðŸ™‚</li><li>Part three &#8211; Coming soon &#8230;</li></ul>



<p><strong> Website</strong>: <a rel="noreferrer noopener" href="https://hack.bg" target="_blank">https://hack.bg</a></p>



<p><strong>Follow us on social media:</strong></p>



<ul><li><a rel="noreferrer noopener" href="https://twitter.com/hack_bg" target="_blank">Twitter</a></li><li><a rel="noreferrer noopener" href="https://facebook.com/hackbg" target="_blank">Facebook</a></li><li><a rel="noreferrer noopener" href="https://www.linkedin.com/company/hackbg-blockchain-web-software-solutions/" target="_blank">LinkedIn</a></li><li><a href="https://meetup.com/blockchain-developers-meetup-bulgaria">Blockchain Developers Meetup</a></li></ul>
</div><h2 class="font-family-sans-serif h4">Tags:</h2><ul class="list-inline"><li class="list-inline-item"><a href="/tag/blockchain/" target="_self" class="btn mb-2 btn-primary btn-sm">Blockchain (44)</a></li><li class="list-inline-item"><a href="/tag/ethereum/" target="_self" class="btn mb-2 btn-primary btn-sm">Ethereum (11)</a></li><li class="list-inline-item"><a href="/tag/smart-contracts/" target="_self" class="btn mb-2 btn-primary btn-sm">Smart Contracts (19)</a></li><li class="list-inline-item"><a href="/tag/solidity/" target="_self" class="btn mb-2 btn-primary btn-sm">Solidity (6)</a></li><li class="list-inline-item"><a href="/tag/unit-testing/" target="_self" class="btn mb-2 btn-primary btn-sm">Unit Testing (1)</a></li></ul></div></article></div></main></div><div class="row mt-5 p-2 newsletter" data-v-102ecac7 data-v-102ecac7><div class="img-container col-sm-3 col-12" data-v-102ecac7><img src="/assets/img/hack_newsletter.7a223066.png" alt="newsletter" width="90%" data-v-102ecac7></div><div class="col" data-v-102ecac7><h3 data-v-102ecac7>Let's build the decentralized future together!</h3><h4 data-v-102ecac7>Subscribe for updates from the blog</h4><form class="form-inline" data-v-102ecac7><fieldset class="form-group" data-v-102ecac7><!----><div tabindex="-1" role="group" class="bv-no-focus-ring"><div class="row" data-v-102ecac7><div class="mb-2 mb-md-0 col" data-v-102ecac7><label for="email" class="sr-only" data-v-102ecac7>E-mail</label><input id="email" type="text" placeholder="Your email" value="" class="mb-2 mr-sm-2 w-100 h-100 form-control" data-v-102ecac7><div aria-hidden="true" style="position:absolute;left:-5000px;" data-v-102ecac7><input type="text" name="b_2f5135b55e33a57f177a0e158_16c540b6e8" tabindex="-1" value="" data-v-102ecac7></div></div><div class="col-md-4 col-12" data-v-102ecac7><button type="submit" class="btn w-100 btn-primary" data-v-102ecac7>Subscribe</button></div></div><!----><!----><!----></div></fieldset><!----><!----><!----></form></div></div><div class="row mt-2"><div id="comments" class="comments-area col"><!----><ol class="comment-list"></ol></div></div></main><!----></div><footer class="bg-white py-5 mt-5" data-v-695cf326><div class="container" data-v-695cf326 data-v-695cf326><hr data-v-695cf326><div class="row" data-v-695cf326 data-v-695cf326><div class="col-lg" data-v-695cf326 data-v-695cf326><img src="/assets/img/hack-logo.a62cc95d.png" alt="hack-logo" width="100%" data-v-695cf326><ul class="flex-wrap" data-v-695cf326><li data-v-695cf326><a href="mailto:hello@hack.bg" title="Get in touch: hello@hack.bg" data-v-695cf326>hello@hack.bg</a></li><li data-v-695cf326><a href="tel:00359898725100" title="Call us: 00 359 898 725 100" data-v-695cf326>00 359 898 725 100</a></li><li data-v-695cf326><abbr title="We are based in Sofia, Bulgaria" data-v-695cf326>Floor 4, 47 Cherni Vrah blvd. Sofia 1407, Bulgaria</abbr></li><li data-v-695cf326><a href="//facebook.com/hackbg" target="_blank" title="hack - facebook page" data-v-695cf326><i class="fab fa-facebook" data-v-695cf326></i></a><a href="//linkedin.com/company/hackbg-blockchain-web-software-solutions" target="_blank" title="hack - linkedin company page" data-v-695cf326><i class="fab fa-linkedin" data-v-695cf326></i></a><a href="//twitter.com/hack_bg" target="_blank" title="hack - twitter company page" data-v-695cf326><i class="fab fa-twitter" data-v-695cf326></i></a><a href="//github.com/hackbg" target="_blank" title="hack - github page" data-v-695cf326><i class="fab fa-github" data-v-695cf326></i></a><a href="//gitter.im/hack-blockchain-development/lobby" target="_blank" title="hack - gitter chat" data-v-695cf326><i class="fab fa-gitter" data-v-695cf326></i></a><a href="//medium.com/hack" target="_blank" title="hack - blog on medium" data-v-695cf326><i class="fab fa-medium" data-v-695cf326></i></a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Services</h2><ul data-v-695cf326><li data-v-695cf326><a href="/dlt-blockchain-development-services/blockchain-software-development/" title="Blockchain Development services" data-v-695cf326>Blockchain Development</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/smart-contracts-development/" title="Smart contract development services" data-v-695cf326>Smart Contracts</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/smart-contract-audits/" title="Blockchain Consulting and Advisory" data-v-695cf326>Smart contract Audits</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/ico-initial-coin-offering/" title="Funrasing and crowsale" data-v-695cf326>Crowdsale</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/blockchain-consulting/" title="Blockchain Consulting and Advisory" data-v-695cf326>Consulting</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/decentralized-applications-development/" title="Decentralized Applications Consulting and Development" data-v-695cf326>Decentralized Applications Development</a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Products</h2><ul data-v-695cf326><li data-v-695cf326><a href="//github.com/mradkov/vscode-sophia" data-v-695cf326>Sophia VSCode</a></li><li data-v-695cf326><a href="//waellet.com" data-v-695cf326>Waellet</a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Company</h2><ul data-v-695cf326><li data-v-695cf326><a href="/#clients-and-partners" title="Our clients portfolio" data-v-695cf326>Clients and partners</a></li><li data-v-695cf326><a href="/events" title="Events organized by hack" data-v-695cf326>Events</a></li><li data-v-695cf326><a href="/careers" title="Careers at hack" data-v-695cf326>Careers</a></li><li data-v-695cf326><a href="/blog" title="hack - blog" data-v-695cf326>Blog</a></li><li data-v-695cf326><a href="//github.com/hackbg/hack-media-kit/" target="_blank" title="hack media kit" data-v-695cf326>Press</a></li><li data-v-695cf326><a href="/privacy-policy/" title="hack privacy policy" data-v-695cf326>Privacy Policy</a></li></ul></div></div></div><p class="text-center" data-v-695cf326>
    Â©
    <a href="https://hack.bg/" data-v-695cf326>hack.bg</a> Ltd - All rights reserved, 2016 - 2020
  </p></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"286","title":"[Part two &#8211; Unit Testing] Build a Decentralized Domain Name System (DDNS) on top of Ethereum","date":"2018-12-29T09:30:09","content":"\n\u003Cp class=\"has-drop-cap\"\u003EWhether you develop software yourself or \u003Ca href=\"https:\u002F\u002Fhack.bg\u002F#contact\"\u003Ehire developers\u003C\u002Fa\u003E to build it for you, you expect them to do everything necessary, so you can get functional and bug-free software. Sometimes, however, doing the right thing takes additional time, which is often being skipped due to all the deadlines, budget or some other reason.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn blockchain development as in the traditional software development, unit testing reduces the number of bugs, making it &#8220;a must&#8221; to effective software development. \u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn this article, we are going to look at this type of testing &#8211; unit testing &#8211; and why you should not cut corners and skip this part of the software development cycle.\u003C\u002Fp\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack-1024x683.jpg\" alt=\"Unit Testing Decentralized Domain Name System\" class=\"wp-image-386\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack-1024x683.jpg 1024w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack-300x200.jpg 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack-768x512.jpg 768w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack-864x576.jpg 864w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack.jpg 1200w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \u002F\u003E\u003Cfigcaption\u003EUnit Testing Decentralized Domain Name System\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cp\u003EThis is part two of our series of building decentralized domain name system on top of \u003Ca href=\"https:\u002F\u002Fethereum.org\u002F\"\u003EEthereum\u003C\u002Fa\u003E, where we&#8217;ll get familiar with good practices and techniques during \u003Cg class=\"gr_ gr_34 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep\" id=\"34\" data-gr-id=\"34\"\u003Eunit\u003C\u002Fg\u003E testing process and deployment of a decentralized application (\u003Cg class=\"gr_ gr_14 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"14\" data-gr-id=\"14\"\u003EdApp\u003C\u002Fg\u003E) development lifecycle.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn the first part, we developed a decentralized application consisted of Ethereum smart contracts, that are acting as a decentralized domain name system. So, at this point, a user should be able to buy, renew, edit and transfer a domain name according to our \u003Cg class=\"gr_ gr_191 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"191\" data-gr-id=\"191\"\u003EdApp&#8217;s\u003C\u002Fg\u003E logic. If you haven&#8217;t checked out \u003Ca href=\"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fpart-one-smart-contracts-build-a-decentralized-domain-name-system-ddns-on-top-of-ethereum\u002F\"\u003Ethe first part of our tutorial\u003C\u002Fa\u003E yet &#8211; this is probably the time to do so.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ETo sum up:\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003EUnit tests are code that tests your contract code\u003C\u002Fli\u003E\u003Cli\u003EIt executes your contract with predefined function calls (test cases)\u003C\u002Fli\u003E\u003Cli\u003EIt compares the result of the execution with the expected result for this case\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Ch2\u003ETooling\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EThe most popular and commonly used way of creating unit tests for Ethereum smart contracts written in Solidity is by using the following tool-set.\u003C\u002Fp\u003E\n\n\n\n\u003Col\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Ftruffleframework.com\u002Ftruffle\"\u003ETruffle\u003C\u002Fa\u003E &#8211; is the most popular development framework for Ethereum. \u003Cul\u003E\u003Cli\u003EBuilt-in smart contract compilation, linking, deployment and binary management.\u003C\u002Fli\u003E\u003Cli\u003EAutomated contract testing for rapid development.\u003C\u002Fli\u003E\u003Cli\u003EScriptable, extensible deployment &amp; migrations framework.\u003C\u002Fli\u003E\u003Cli\u003ENetwork management for deploying to any number of public &amp; private networks.\u003C\u002Fli\u003E\u003Cli\u003EPackage management with EthPM &amp; NPM, using the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fethereum\u002FEIPs\u002Fissues\u002F190\"\u003EERC190\u003C\u002Fa\u003E standard.\u003C\u002Fli\u003E\u003Cli\u003EInteractive console for direct contract communication.\u003C\u002Fli\u003E\u003Cli\u003EConfigurable build pipeline with support for tight integration.\u003C\u002Fli\u003E\u003Cli\u003EExternal script runner that executes scripts within a Truffle environment. \u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Ftruffleframework.com\u002Fganache\"\u003EGanache\u003C\u002Fa\u003E &#8211; lets you quickly fire up a personal Ethereum blockchain which you can use to run tests, execute commands, and inspect state while controlling how the chain operates.\u003C\u002Fli\u003E\u003C\u002Fol\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cp\u003EWithout further due, let&#8217;s jump into setting up our project and environment for unit testing.\u003Cbr\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EFirst if we haven&#8217;t already, we need to install Truffle globally (-g)\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Enpm install -g truffle\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003Eand Ganache &#8211; It is available as both a desktop application as well as a command-line tool (formerly known as the TestRPC). For the purpose of our tutorial we are going to use the command-line tool.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Enpm install -g ganache-cli\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Cg class=\"gr_ gr_5 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del\" id=\"5\" data-gr-id=\"5\"\u003EOkey\u003C\u002Fg\u003E, now we are good to go. There is a tutorial for using truffle for \u003Cg class=\"gr_ gr_37 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep\" id=\"37\" data-gr-id=\"37\"\u003Eunit\u003C\u002Fg\u003E testing in their website \u003Ca href=\"https:\u002F\u002Ftruffleframework.com\u002Ftutorials\u002Ftesting-for-throws-in-solidity-tests\"\u003Ehere\u003C\u002Fa\u003E, but \u003Cg class=\"gr_ gr_18 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep\" id=\"18\" data-gr-id=\"18\"\u003E\u003Ccode\u003Ethrow\u003C\u002Fcode\u003E\u003C\u002Fg\u003E function used there is now deprecated and replaced by \u003Ccode\u003Erevert()\u003C\u002Fcode\u003E, \u003Ccode\u003Erequire()\u003C\u002Fcode\u003E and \u003Ccode\u003Eassert()\u003C\u002Fcode\u003E. So it will be somewhat helpful if you know how the last work.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ENevertheless, let us verify our knowledge by a quick lookup at the \u003Ca href=\"https:\u002F\u002Fsolidity.readthedocs.io\u002Fen\u002Fdevelop\u002Fcontrol-structures.html#error-handling-assert-require-revert-and-exceptions\"\u003ESolidity documentation\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\n\n\n\u003Cblockquote class=\"wp-block-quote\"\u003E\u003Cp\u003EError handling: Assert, Require, Revert and Exceptions\u003Cbr\u003E Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the state in the current call (and all its sub-calls) and also flag an error to the caller. The convenience functions \u003Ccode\u003Eassert\u003C\u002Fcode\u003E and \u003Ccode\u003Erequire\u003C\u002Fcode\u003E can be used to check for conditions and throw an exception if the condition is not met. The \u003Ccode\u003Eassert\u003C\u002Fcode\u003E function should only be used to test for internal errors, and to check invariants. The \u003Ccode\u003Erequire\u003C\u002Fcode\u003E  function should be used to ensure valid conditions, such as inputs, or  contract state variables are met, or to validate return values from  calls to external contracts. If used properly, analysis tools can evaluate your contract to identify  the conditions and function calls which will reach a failing \u003Ccode\u003Eassert\u003C\u002Fcode\u003E.  Properly functioning code should never reach a failing assert  statement; if this happens there is a bug in your contract which you  should fix.\u003Cbr\u003E There are two other ways to trigger exceptions: The \u003Ccode\u003Erevert\u003C\u002Fcode\u003E function can be used to flag an error and revert the current call. It is possible to provide a string message containing details about the error that will be passed back to the caller.\u003C\u002Fp\u003E\u003Ccite\u003ESolidity documentation\u003C\u002Fcite\u003E\u003C\u002Fblockquote\u003E\n\n\n\n\u003Ch2\u003EProject initialization\u003C\u002Fh2\u003E\n\n\n\n\u003Cp class=\"note\"\u003E\u003Cstrong\u003ENote:\u003C\u002Fstrong\u003E If you have initialized your project with \u003Ccode\u003Etruffle init\u003C\u002Fcode\u003E you can skip this part.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn the first part we covered mainly the code, but not the environment, IDE and project setup, but for our tests to run properly we will need that set.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ESetting up a new truffle project:\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Etruffle init\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fdecentralized-dns-truffle-init.png\" alt=\"Decentralized Domain Name System - project initialization\" class=\"wp-image-345\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fdecentralized-dns-truffle-init.png 682w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fdecentralized-dns-truffle-init-300x248.png 300w\" sizes=\"(max-width: 682px) 100vw, 682px\" \u002F\u003E\u003Cfigcaption\u003EDecentralized Domain Name System &#8211; project initialization\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAs you notice after project initialization Truffe adds some files into our project directory: \u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E\u003Ccode\u003E.\u002Fcontracts\u003C\u002Fcode\u003E &#8211; directory where our smart contracts should be stored.\u003C\u002Fli\u003E\u003Cli\u003E\u003Ccode\u003E.\u002Fmigrations\u003C\u002Fcode\u003E &#8211; directory for placing our migrations scripts.\u003C\u002Fli\u003E\u003Cli\u003E\u003Ccode\u003E.\u002Ftest\u003C\u002Fcode\u003E &#8211; directory for test files for testing our decentralized application.\u003C\u002Fli\u003E\u003Cli\u003E\u003Ccode\u003E.\u002Ftruffle-config.js\u003C\u002Fcode\u003E &#8211; this is our project&#8217;s truffle configuration file.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Ch2\u003EWriting Unit Tests\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EWriting unit tests is a must for decentralized applications development life-cycle, so we can be sure the application works \u003Cstrong\u003Ethe way it is designed to\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ESo Truffle gives us couple of possible options to write tests &#8211; in JavaScript, TypeScript (testing your contract via web3) or Solidity (testing your contract from another contract). In our tutorial we will cover unit testing with JavaScript which its the most adopted way of doing so in my opinion.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EAll contracts in truffle&#8217;s contracts folder are accessible and are published automatically for our tests. Our unit tests should be placed in the \u003Ccode\u003E.\u002Ftest\u003C\u002Fcode\u003E folder and must end with \u003Ccode\u003E.js\u003C\u002Fcode\u003E extension so it can be recognized as an automated test by \u003Ca href=\"https:\u002F\u002Fmochajs.org\u002F\"\u003EMocha\u003C\u002Fa\u003E framework which Truffle uses for testing. For the assertions Truffle uses \u003Ca href=\"https:\u002F\u002Fwww.chaijs.com\u002F\"\u003EChai\u003C\u002Fa\u003E, which you may or may not be familiar with.\u003C\u002Fp\u003E\n\n\n\n\u003Cblockquote class=\"wp-block-quote is-style-default\"\u003E\u003Cp\u003EChai is a BDD \u002F TDD assertion library for \u003Ca href=\"http:\u002F\u002Fnodejs.org\"\u003Enode\u003C\u002Fa\u003E and can be paired with any javascript testing framework.\u003C\u002Fp\u003E\u003Ccite\u003EChaijs\u003C\u002Fcite\u003E\u003C\u002Fblockquote\u003E\n\n\n\n\u003Cp\u003ETruffle&#8217;s got well structured, extensive \u003Ca href=\"https:\u002F\u002Ftruffleframework.com\u002Fdocs\u002Ftruffle\u002Foverview\"\u003Edocumentation\u003C\u002Fa\u003E which you can read upon and get familiar with, if you want to.\u003C\u002Fp\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cfigure class=\"wp-block-pullquote is-style-default\"\u003E\u003Cblockquote\u003E\u003Cp\u003ESo starting with the structure of a unit test case.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Cp\u003EA test is a call of a contract function with predefined (hard-coded) arguments and a predefined expected output. And the expected output should be the correct way the contract functions.\u003C\u002Fp\u003E\n\n\n\n\u003Cblockquote class=\"wp-block-quote\"\u003E\u003Cp\u003EWhat makes Truffle tests different from that of Mocha is the \u003Ccode\u003Econtract()\u003C\u002Fcode\u003E function: This function works exactly like \u003Ccode\u003Edescribe()\u003C\u002Fcode\u003E except it enables Truffle&#8217;s \u003Ca href=\"https:\u002F\u002Ftruffleframework.com\u002Fdocs\u002Ftruffle\u002Ftesting\u002Ftesting-your-contracts#clean-room-environment\"\u003Eclean-room features\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Ccite\u003ETruffle documentation\u003C\u002Fcite\u003E\u003C\u002Fblockquote\u003E\n\n\n\n\u003Cp\u003EEach group of tests is ran with clean contract state, meaning that for every test new contract is being published.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EHere is how our DDNSService.test.js should look like:\u003C\u002Fp\u003E\n\n\n\n\u003Cpre\u003E\u003Ccode\u003E\n\nconst DDNSService = artifacts.require('..\u002Fcontracts\u002FDDNSService.sol')\n\n\u002F\u002F place helpers here\n\ncontract('DDNSService', ([owner, wallet, anotherAccount]) =&gt; {\n\tlet contractInstance;\n\tlet events = [];\n\n\tbefore(() =&gt; {\n\t\tweb3.eth.defaultAccount = owner;\n\t});\n\n\tbeforeEach(async () =&gt; {\n\t\tcontractInstance = await DDNSService.new();\n\t});\n\n\tafterEach(() =&gt; {\n\t\tif (events.length) {\n\t\t\tevents.forEach((ev) =&gt; {\n\t\t\t\tev.stopWatching();\n\t\t\t});\n\n\t\t\tevents = [];\n\t\t}\n    });\n  \n    it(\"BYTES_DEFAULT_VALUE constant Should have exact value\", async () =&gt; {\n\t\t\u002F\u002F Arrange\n\n\t\t\u002F\u002F Act\n\t\tconst result = await contractInstance.BYTES_DEFAULT_VALUE();\n\n\t\t\u002F\u002F Assert\n\t\tassert.equal(result, '0x00');\n   });\n\n... more tests \n\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn the code above, we&#8217;ve set our contract instance and written the first test, which tests whether the \u003Ccode\u003EBYTES_DEFAULT_VALUE\u003C\u002Fcode\u003E constant in our smart contract is set to \u003Ccode\u003E0x00\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EHere is a more sophisticated example &#8211; \u003Ci\u003Eregister Should throw when the sent funds are insufficient\u003C\u002Fi\u003E &#8211; we are getting the price for the passed domain name, IP, TLD, substract 1 via \u003Ccode\u003E.minus(1)\u003C\u002Fcode\u003E so we can have a smaller than the actual domain price saved in our \u003Ccode\u003EcurrentPrice\u003C\u002Fcode\u003E constant, which we pass as value argument for the domain register via the \u003Ccode\u003Eregister()\u003C\u002Fcode\u003E function afterwards. Then we assert whether the call failed with \u003Ccode\u003EassertRevert\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre\u003E\u003Ccode\u003Eit(\"register Should throw when the sent funds are insufficient\", async () =&gt; {\n\t\t\u002F\u002F Arrange\n\t\tconst domainName = \"milenradkov\";\n\t\tconst ip = \"127.0.0.1\";\n\t\tconst topLevelDomain = \"com\";\n\t\tconst currentPrice = (await contractInstance.getPrice(domainName)).minus(1);\n\t\t\u002F\u002F Act\n\t\tconst result = contractInstance.register(domainName, topLevelDomain, ip, { from: anotherAccount, value: currentPrice });\n\t\t\u002F\u002F Assert\n\t\tawait assertRevert(result);\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EUnit tests in truffle can be written \u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"4\" data-gr-id=\"4\"\u003Eusing \u003C\u002Fg\u003E\u003Ccode\u003E.then\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"4\" data-gr-id=\"4\"\u003E \u003C\u002Fg\u003E\u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"5\" data-gr-id=\"5\"\u003E\u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"4\" data-gr-id=\"4\"\u003Eor\u003C\u002Fg\u003E \u003C\u002Fg\u003E\u003Ccode\u003Eawait\u002Fasync\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"5\" data-gr-id=\"5\"\u003E style\u003C\u002Fg\u003E, so it&#8217;s up to the developer&#8217;s preference how to write them.\u003C\u002Fp\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cp\u003ETesting the contract against the cases we&#8217;ve coded is really simple:\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E1. Start \u003Ccode\u003Eganache-cli\u003C\u002Fcode\u003E in separate terminal\u002Fcmd &#8211; this will instantiate our private blockchain which we are going to use for tests.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre\u003E\u003Ccode\u003Eganache-cli\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E2. Run \u003Ccode\u003Etruffle test\u003C\u002Fcode\u003E command from the project directory.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre\u003E\u003Ccode\u003Etruffle test\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Cp\u003EAs you&#8217;ve probably noticed already, we are using the so known AAA (\u003Ca href=\"http:\u002F\u002Fwiki.c2.com\u002F?ArrangeActAssert\"\u003EArrange Act Assert\u003C\u002Fa\u003E) pattern for our unit tests &#8211; it&#8217;s always good to stick to well-formatted code and best practices when you are coding for lots of well-known reasons.\u003C\u002Fp\u003E\n\n\n\n\u003Cblockquote class=\"wp-block-quote\"\u003E\u003Cp\u003E&#8220;Arrange-Act-Assert&#8221;a pattern for arranging and formatting code in \u003Ca href=\"http:\u002F\u002Fwiki.c2.com\u002F?UnitTest\"\u003EUnitTest\u003C\u002Fa\u003E methods: \u003C\u002Fp\u003E\u003Cp\u003EEach method should group these functional sections, separated by blank lines: \u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E \u003Cstrong\u003EArrange\u003C\u002Fstrong\u003E all necessary preconditions and inputs.\n\u003C\u002Fli\u003E\u003Cli\u003E \u003Cstrong\u003EAct\u003C\u002Fstrong\u003E on the object or method under test.\n\u003C\u002Fli\u003E\u003Cli\u003E \u003Cstrong\u003EAssert\u003C\u002Fstrong\u003E that the expected results have occurred.\n\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Ccite\u003EArrange-Act-Assert pattern unit test\u003C\u002Fcite\u003E\u003C\u002Fblockquote\u003E\n\n\n\n\u003Ch3\u003EHelpers\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003EWe are going to need some predefined helpers for some of our next test cases, which names are speaking for what they actually do respectively.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre\u003E\u003Ccode\u003E\n\u002F\u002Fhelpers\nconst assertRevert = require('.\u002Futils\u002FassertRevert');\nconst watchEvent = require('.\u002Futils\u002FwatchEvent');\nconst constants = require('.\u002Futils\u002Fconstants');\nconst increaseTime = require('.\u002Futils\u002FincreaseTime');\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Ch3\u003ECoverage\u003C\u002Fh3\u003E\n\n\n\n\u003Cp\u003EFollowing this logic here are all the test cases covering most of the edge cases of our decentralized domain name service smart contract functions.\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure\u003E\u003Cscript src=\"https:\u002F\u002Fgist.github.com\u002Fmradkov\u002F2470c611a7a3d0be1508ead681929a90.js\"\u003E\u003C\u002Fscript\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Chr class=\"wp-block-separator\"\u002F\u003E\n\n\n\n\u003Ch2\u003ERunning tests\u003C\u002Fh2\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli.png\" alt=\"instantiate ganache-cli\" class=\"wp-image-376\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli.png 799w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli-300x202.png 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli-768x516.png 768w\" sizes=\"(max-width: 799px) 100vw, 799px\" \u002F\u003E\u003Cfigcaption\u003Einstantiate ganache-cli\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli_running.png\" alt=\"ganache-cli running\" class=\"wp-image-377\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli_running.png 799w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli_running-300x202.png 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Fganache_cli_running-768x516.png 768w\" sizes=\"(max-width: 799px) 100vw, 799px\" \u002F\u003E\u003Cfigcaption\u003Eganache-cli running\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test.png\" alt=\"truffle test - Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum\" class=\"wp-image-378\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test.png 843w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test-300x215.png 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test-768x550.png 768w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test-804x576.png 804w\" sizes=\"(max-width: 843px) 100vw, 843px\" \u002F\u003E\u003Cfigcaption\u003Etruffle test &#8211; Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test_passing.png\" alt=\"Truffle Test passing - Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum\" class=\"wp-image-379\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test_passing.png 843w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test_passing-300x215.png 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test_passing-768x550.png 768w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Ftruffle_test_passing-804x576.png 804w\" sizes=\"(max-width: 843px) 100vw, 843px\" \u002F\u003E\u003Cfigcaption\u003ETruffle Test passing &#8211; Decentralized Domain Name System using Solidity Smart Contracts on top of Ethereum\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EUnit testing are important when developing smart contracts on Ethereum, as there are lots of vulnerabilities or edge cases that can lead to security flaws or value (ETH) theft.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn the next few parts we will set up code coverage and continuous integration with Travis CI. \u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EAlso we will look deeper in to the security part of development and testing, tips and tricks and more, so \u003Ca href=\"http:\u002F\u002Feepurl.com\u002FgcxyRj\"\u003Estay tuned.\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Ch3\u003E\u003Cstrong\u003EUseful links\u003C\u002Fstrong\u003E\u003C\u002Fh3\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fpart-one-smart-contracts-build-a-decentralized-domain-name-system-ddns-on-top-of-ethereum\u002F\"\u003EPart one &#8211; Smart Contracts &#8211; Build Decentralized Domain Name System on top of Ethereum\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003EPart two &#8211; Unit Testing &#8211; [you are here] ðŸ™‚\u003C\u002Fli\u003E\u003Cli\u003EPart three &#8211; Coming soon &#8230;\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\n\u003Cp\u003E\u003Cstrong\u003E Website\u003C\u002Fstrong\u003E: \u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fhack.bg\" target=\"_blank\"\u003Ehttps:\u002F\u002Fhack.bg\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Cstrong\u003EFollow us on social media:\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Ftwitter.com\u002Fhack_bg\" target=\"_blank\"\u003ETwitter\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Ffacebook.com\u002Fhackbg\" target=\"_blank\"\u003EFacebook\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca rel=\"noreferrer noopener\" href=\"https:\u002F\u002Fwww.linkedin.com\u002Fcompany\u002Fhackbg-blockchain-web-software-solutions\u002F\" target=\"_blank\"\u003ELinkedIn\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fmeetup.com\u002Fblockchain-developers-meetup-bulgaria\"\u003EBlockchain Developers Meetup\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n","featuredMedia":{"sourceUrl":"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2018\u002F12\u002Funit-testing-decentralized-domain-name-system-hack.jpg","altText":"Unit Testing Decentralized Domain Name System","mediaDetails":{"width":1200}},"categories":[{"id":"4","title":"Tutorials","path":"\u002Fcategory\u002Ftutorials\u002F"}],"tags":[{"id":"13","title":"Blockchain","path":"\u002Ftag\u002Fblockchain\u002F","count":44},{"id":"12","title":"Ethereum","path":"\u002Ftag\u002Fethereum\u002F","count":11},{"id":"20","title":"Smart Contracts","path":"\u002Ftag\u002Fsmart-contracts\u002F","count":19},{"id":"14","title":"Solidity","path":"\u002Ftag\u002Fsolidity\u002F","count":6},{"id":"61","title":"Unit Testing","path":"\u002Ftag\u002Funit-testing\u002F","count":1}],"author":{"name":"Milen Radkov","path":"\u002Fauthor\u002Fmilen\u002F"}}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.7015662a.js" defer></script><script src="/assets/js/page--src--templates--word-press-post-vue.c47e6f40.js" defer></script>
  </body>
</html>
