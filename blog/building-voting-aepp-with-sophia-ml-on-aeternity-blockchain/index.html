<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title> - hack</title><meta name="gridsome:hash" content="6e4a16ae583830626604484392b63bb9aecbdcf7"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.20"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="google-site-verification" content="tMFprx4hdKjMcjVdQJ5-NfuZbUikunZmJJWUI_tvYYM"><meta data-vue-tag="ssr" name="waellet-tip-verification" content="ak_2DDLbYBhHcuAzNg5Un853NRbUr8JVjZeMc6mTUpwmiVzA4ic6X"><meta data-vue-tag="ssr" name="robots" content="index, follow, max-snippet:-1, max-video-preview:-1, max-image-preview:large"><meta data-vue-tag="ssr" property="article:publisher" content="https://facebook.com/hackbg"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:creator" content="@hack_bg"><meta data-vue-tag="ssr" property="og:locale" content="en_US"><meta data-vue-tag="ssr" name="description" content="Create a simple voting aepp (æpp) on aeternity blockchain using Sophia ML smart contract"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content=""><meta data-vue-tag="ssr" property="og:description" content="Time is passing by and we are getting more experienced in writing smart contracts with Sophia ML language on æternity [&amp;hellip;]"><meta data-vue-tag="ssr" property="og:url" content="https://hack.bg/blog/tutorials/building-voting-aepp-with-sophia-ml-on-aeternity-blockchain/"><meta data-vue-tag="ssr" property="og:updated_time" content="2019-01-25T13:39:50"><meta data-vue-tag="ssr" property="og:image" content="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg"><meta data-vue-tag="ssr" property="og:image:secure_url" content="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg"><meta data-vue-tag="ssr" property="og:image:width" content="960"><meta data-vue-tag="ssr" property="og:image:height" content="540"><meta data-vue-tag="ssr" property="og:image:alt" content=""><meta data-vue-tag="ssr" property="og:image:type" content="image/jpeg"><meta data-vue-tag="ssr" property="article:published_time" content="2019-01-23T20:11:11"><meta data-vue-tag="ssr" property="article:modified_time" content="2019-01-25T13:39:50"><meta data-vue-tag="ssr" property="article:tag" content="Aeternity"><meta data-vue-tag="ssr" property="article:tag" content="Blockchain"><meta data-vue-tag="ssr" property="article:tag" content="Smart Contracts"><meta data-vue-tag="ssr" property="article:tag" content="Sophia ML"><meta data-vue-tag="ssr" property="article:tag" content="Tutorial"><meta data-vue-tag="ssr" property="article:section" content="Tutorials"><meta data-vue-tag="ssr" property="article:section" content="Tech Talks"><meta data-vue-tag="ssr" name="twitter:title" content=""><meta data-vue-tag="ssr" name="twitter:description" content="Time is passing by and we are getting more experienced in writing smart contracts with Sophia ML language on æternity [&amp;hellip;]"><meta data-vue-tag="ssr" name="twitter:image" content="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9d75eceeef7809cf4608be253410ffaa.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400&amp;display=swap"><link data-vue-tag="ssr" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous"><link rel="preload" href="/assets/css/0.styles.85ca9fb1.css" as="style"><link rel="preload" href="/assets/js/app.b7ca855b.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--word-press-post-vue.d7ca6f50.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.a73697d7.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.fcf39de1.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.6a3cd783.js"><link rel="prefetch" href="/assets/js/page--src--pages--case-studies-vue.15651eb8.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.4a08c2af.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-author-vue.c57c0cbb.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-category-vue.379d684e.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-page-vue.2933ab7c.js"><link rel="prefetch" href="/assets/js/page--src--templates--word-press-post-tag-vue.ab1199bc.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--blog-vue~page--src--templates--word-press-author-vue~page--src--templates-~6ae1152d.3c03f953.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-category-vue.e7c986f6.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-post-tag-vue.2e2325ff.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--word-press-post-vue.03f9d501.js"><link rel="stylesheet" href="/assets/css/0.styles.85ca9fb1.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="body-bg"><div class="container"><header class="py-2 header" data-v-77ea2ff0><nav id="nav-header" class="navbar p-1 navbar-light navbar-expand-lg" data-v-77ea2ff0><div class="navbar-brand" data-v-77ea2ff0><a href="/" target="_self" class="navbar-brand font-family-headings router-link-active" data-v-77ea2ff0><img src="/assets/img/hack-logo.a62cc95d.png" alt="hack-logo" height="80" data-v-77ea2ff0></a></div><button type="button" aria-label="Toggle navigation" class="navbar-toggler" data-v-77ea2ff0><span class="navbar-toggler-icon"></span></button><div id="nav-collapse" class="navbar-collapse collapse" style="display:none;" data-v-77ea2ff0><ul class="navbar-nav ml-auto align-middle" data-v-77ea2ff0><li class="nav-item text-primary" data-v-77ea2ff0><a href="/#home" target="_self" class="nav-link" data-v-77ea2ff0>Home</a></li><li class="nav-item" data-v-77ea2ff0><a href="#" target="_self" class="nav-link" data-v-77ea2ff0><a href="/case-studies" data-v-77ea2ff0>How to use blockchain</a></a></li><li class="nav-item b-nav-dropdown dropdown dropper" data-v-77ea2ff0><a role="button" aria-haspopup="true" aria-expanded="false" href="#" target="_self" class="nav-link dropdown-toggle"><span>Services</span></a><ul tabindex="-1" class="dropdown-menu dropdown-menu-right"><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/dlt-blockchain-development-services/blockchain-software-development" target="_self" class="dropdown-item">Blockchain Development</a></li><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/dlt-blockchain-development-services/smart-contracts-development" target="_self" class="dropdown-item">Smart Contracts Development</a></li><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/dlt-blockchain-development-services/smart-contract-audits" target="_self" class="dropdown-item">Smart Contract Audits</a></li><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/dlt-blockchain-development-services/blockchain-consulting" target="_self" class="dropdown-item">Consulting</a></li><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/dlt-blockchain-development-services/decentralized-applications-development" target="_self" class="dropdown-item">Decentralized application (dApp) development</a></li><li role="presentation" data-v-77ea2ff0><hr role="separator" aria-orientation="horizontal" class="dropdown-divider" data-v-77ea2ff0></li><li role="presentation" data-v-77ea2ff0><a role="menuitem" href="/#services" target="_self" class="dropdown-item">All services</a></li></ul></li><li class="nav-item text-primary" data-v-77ea2ff0><a href="/#about" target="_self" class="nav-link" data-v-77ea2ff0>About us</a></li><li class="nav-item" data-v-77ea2ff0><a href="/blog" target="_self" class="nav-link active" data-v-77ea2ff0>Blog</a></li><li class="nav-item" data-v-77ea2ff0><a href="/#contact" target="_self" class="nav-link" data-v-77ea2ff0><span class="contact" data-v-77ea2ff0>Get in touch</span></a></li></ul></div></nav></header><!----><main><div class="row align-items-start"><main class="bg-white p-0 rounded shadow-lg col-lg-12 col-12"><div class="overflow-hidden p-4 p-sm-5"><article class="row" data-v-a4132618 data-v-a4132618><div data-first="B" class="meta-data py-md-5 text-center position-relative d-flex col-md-3" data-v-a4132618 data-v-a4132618><div class="mx-auto mb-2 position-relative" data-v-a4132618><span class="post-date font-weight-bold" data-v-a4132618>23 Jan 2019</span><i class="d-none d-md-block" data-v-a4132618>in:</i><ul class="list-inline mb-0" data-v-a4132618><li class="list-inline-item m-0"><a href="/category/tutorials/" class="text-uppercase font-weight-bold mx-1">Tutorials</a><span>·</span></li><li class="list-inline-item m-0"><a href="/category/blockchain-tech-talks/" class="text-uppercase font-weight-bold mx-1">Tech Talks</a><!----></li></ul><div data-v-a4132618><i data-v-a4132618>by:</i><a href="/author/milen/" class="font-weight-bold" data-v-a4132618>Milen</a></div></div></div><div class="mb-5 py-md-5 col" data-v-a4132618 data-v-a4132618><header class="mb-4" data-v-a4132618><h1 class="text-break" data-v-a4132618>Building Voting æpp with Sophia ML on æternity blockchain</h1><img src="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg" alt="" width="960" class="mt-4 img-fluid" data-v-a4132618></header><div class="post-content text-break" data-v-a4132618>
<p>Time is passing by and we are getting more experienced in writing smart contracts with Sophia ML language on æ<g class="gr_ gr_8 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="8" data-gr-id="8">ternity</g> blockchain.</p>



<p>In this tutorial, I&#8217;d like to share with you a simple voting decentralized <g class="gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="3" data-gr-id="3">aepp</g> solution that we&#8217;ve built during the æpps summit in Turkey, which I took part in.</p>



<div class="wp-block-image"><figure class="aligncenter"><img loading="lazy" width="960" height="540" src="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg" alt="" class="wp-image-542" srcset="https://hack.bg/wp-content/uploads/2019/01/aepps-summit.jpg 960w, https://hack.bg/wp-content/uploads/2019/01/aepps-summit-300x169.jpg 300w, https://hack.bg/wp-content/uploads/2019/01/aepps-summit-768x432.jpg 768w" sizes="(max-width: 960px) 100vw, 960px" /><figcaption>photo by nikita fuchs</figcaption></figure></div>



<p>This was one of my first times interacting with Sophia ML smart contracts, and while at the æpps summit I&#8217;ve gathered some cool and enthusiastic people, and made ourselves sort of a studying group. We decided to brainstorm and learn together while developing this voting <g class="gr_ gr_6 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="6" data-gr-id="6">aepp</g>. This is the short summary of what we&#8217;ve decided our voting <g class="gr_ gr_7 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="7" data-gr-id="7">aepp</g> will be doing:</p>



<ol><li>Add candidates to vote for</li><li>Allow users to give their vote for a certain candidate</li><li>Count the votes that every candidate gathered</li></ol>



<p class="note">You can <g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="5" data-gr-id="5">try</g> push the <g class="gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="3" data-gr-id="3">aepp&#8217;s</g> functionalities further, with more sophisticated functions and use case, you can try doing it <g class="gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep" id="7" data-gr-id="7">yourself,</g> <g class="gr_ gr_25 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="25" data-gr-id="25">like</g> we did. Try it &#8211; its fun.</p>



<h2>Setting up project and development <g class="gr_ gr_109 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace gr-progress" id="109" data-gr-id="109">environment</g></h2>



<p><g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="5" data-gr-id="5">First</g> we have to initialize our project where we will write <g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="4" data-gr-id="4">the smart</g> contract. In order to do that we will be using <code>forgae</code>. Take a look at the <a href="https://hack.bg/blog/tutorials/build-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book/">Build first </a><g class="gr_ gr_92 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="92" data-gr-id="92"><a href="https://hack.bg/blog/tutorials/build-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book/">aeternity</a></g><a href="https://hack.bg/blog/tutorials/build-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book/"> application with Sophia ML tutorial</a> and follow the steps to initialize your project.</p>



<h2>Smart contract</h2>



<p>As you probably already know (if you&#8217;ve followed the previous tutorial), in <g class="gr_ gr_3 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="3" data-gr-id="3">Sophia</g> ML we have a <strong>state</strong> which is the place where we store data on-chain, and it is the only thing in the smart contract that can be mutated (overwritten).</p>



<p>The first thing we do is to define our variables and types that we are going to use in the smart contract. And <g class="gr_ gr_217 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="217" data-gr-id="217">the </g><code>init()</code><g class="gr_ gr_217 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="217" data-gr-id="217"> function</g> which is the constructor basically, if we compare this to a Solidity smart contract.</p>



<pre class="wp-block-preformatted"><code>contract Vote =
   type candidate = address
   type votes = list(address)

   record state = 
      { vote : map(candidate, votes) }

   public function init() : state = 
      { vote = { } }</code></pre>



<p>We are defining <g class="gr_ gr_263 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="263" data-gr-id="263">the </g><code>candidate</code><g class="gr_ gr_263 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="263" data-gr-id="263"> type</g> as address, and votes as a <strong>list</strong> of addresses. And the <code>state</code> record will be storing a map (key-value-pair) of <code>candidate</code> to <code>votes</code>.<br></p>



<p><del>Starting with the first functionality for the aepp &#8211; adding candidates:</del></p>



<pre class="wp-block-preformatted"><code><del>  public stateful function add_candidate(candidate: address) : bool =       is_candidate(candidate)       true</del></code></pre>



<p><del>What this does is passing the candidate to the </del><code><del>is_candiate()</del></code><del> function &#8211; taking a candidate&#8217;s address as a parameter, checking if there is a candidate defined at with this address and saving it to the </del><strong><del>votes</del></strong><del> mapping in the state with the initial empty list of voters if not.</del><br></p>



<p><del>Here are the helper functions we are using for this:</del></p>



<pre class="wp-block-preformatted"><code><del>   private stateful function is_candidate(candidate: address) =       let candidate_found = lookupByAddress(candidate, state.votes, { voters = [] })       if (size(candidate_found.voters) == 0)          put(state{             votes[candidate] = { voters = [] } })    private function lookupByAddress(k : address, m, v) =       switch(Map.lookup(k,m))          None => v          Some(x) => x</del></code></pre>



<p>We are doing this because in Sophia ML we don&#8217;t have a default value of 0x0/false as in Solidity for example. So, in order for us to cast a vote, we need to first have added the candidates which we can vote for.</p>



<p class="note">If we don&#8217;t add the candidate first, before voting, we will hit <code>out of gas</code> error.</p>



<p>Next we create the vote function which looks like this:</p>



<pre class="wp-block-preformatted"><code>public stateful function vote(vote_for: candidate) =
      put(state{ vote[vote_for = []] @ vs = Call.caller :: vs })</code></pre>



<p>We access the transaction initiator&#8217;s address by the <g class="gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="3" data-gr-id="3">built </g><g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="4" data-gr-id="4"><g class="gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="3" data-gr-id="3">in</g> </g><code>Call.caller</code><g class="gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="4" data-gr-id="4"> and</g> prepend <g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="5" data-gr-id="5">it </g><code>::</code><g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="5" data-gr-id="5"> to</g> the current list of voters. Using this <g class="gr_ gr_23 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="23" data-gr-id="23">syntx</g> we <g class="gr_ gr_32 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="32" data-gr-id="32">dont</g> need to worry whether the candidate was initialized or not.</p>



<p><g class="gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="9" data-gr-id="9">Last</g> thing is the get votes count function.</p>



<pre class="wp-block-preformatted"><code>public function count_votes(count_for : candidate) =
      length(state.vote[count_for = []])</code></pre>



<p>Here we are using a custom <code>length</code> function which we define as a helper function below. Here is the code and below we can see the explanation.</p>



<pre class="wp-block-preformatted"><code>private function length(l : list('a)) : int = length'(l, 0)
</code></pre>



<p>This is where things get a bit more complicated, so I will try to explain what is happening here.</p>



<p>Since in Sophia ML we don&#8217;t have <code>.count</code> or <code>.length</code> to get the list length, we need to make ourselves a helper function which will make a recursion and will iterate over the list while incrementing a counter.</p>



<p>The <code>length</code> function is defined to accept a list <g class="gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="9" data-gr-id="9">of </g><code>'a</code><g class="gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="9" data-gr-id="9"> which</g> is the convention for a generic <g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep" id="5" data-gr-id="5">type,</g> and a return <g class="gr_ gr_11 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="11" data-gr-id="11">type </g><code>int</code><g class="gr_ gr_11 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="11" data-gr-id="11"> .</g> In the function&#8217;s <g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="6" data-gr-id="6">body</g> we are calling <g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="10" data-gr-id="10">the </g><code>length'</code><g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="10" data-gr-id="10"> </g><g class="gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep" id="7" data-gr-id="7"><g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="10" data-gr-id="10">function</g>,</g> while passing the list and an initial value for the counter.</p>



<pre class="wp-block-preformatted"><code>private function length'(l : list('a), x : int) : int =       switch(l)          [] => x          _ :: l' => length'(l', x + 1)</code></pre>



<p>And here the magic happens, we use <g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="6" data-gr-id="6">the </g><code>switch</code><g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="6" data-gr-id="6"> statement</g> with 2 cases <code>[] => x</code> &#8211; which returns the value of the counter and breaks the recursion if the list is empty. And <code>_ :: l' => length'(l', x+1)</code> &#8211; meaning we are using a pattern matching and we are separating the first element from the list and the remainder and then recursively passing the list&#8217;s remainder to the same <g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep" id="5" data-gr-id="5">function,</g> while incrementing the counter.</p>



<p>The whole smart contract code looks like this in the end</p>



<figure><script src="https://gist.github.com/mradkov/d05aeb76c59e2098d54dc900e94aaa41.js"></script><figcaption>Sophia ML basic voting aepp</figcaption></figure>



<h2>Conclusion</h2>



<p>It is fairly simple to create a basic aepp on æternity blockchain using Sophia ML. In our case with the ae-vote we stumbled upon some tricky parts like the recursive iteration, we had to make above, but when you familiarize yourself with the language it is easier.</p>



<h3>Useful links</h3>



<ul><li><a href="https://github.com/mradkov/ae-vote">Github repo of the project</a></li><li><a href="https://github.com/aeternity/protocol/blob/master/contracts/sophia.md">Sophia documentation</a></li><li><a href="https://dev.aepps.com/">æternity documentation</a></li></ul>
</div><h2 class="font-family-sans-serif h4" data-v-a4132618><i class="fa fa-folder-open" data-v-a4132618></i>Categories:
              </h2><ul class="list-inline" data-v-a4132618><li class="list-inline-item" data-v-a4132618><a href="/category/tutorials/" target="_self" class="btn mb-2 btn-primary btn-sm">Tutorials (9)</a></li><li class="list-inline-item" data-v-a4132618><a href="/category/blockchain-tech-talks/" target="_self" class="btn mb-2 btn-primary btn-sm">Tech Talks (16)</a></li></ul><h2 class="font-family-sans-serif h4" data-v-a4132618><i class="fa fa-tags" data-v-a4132618></i>Tags:
              </h2><ul class="list-inline" data-v-a4132618><li class="list-inline-item" data-v-a4132618><a href="/tag/aeternity/" target="_self" class="btn mb-2 btn-primary btn-sm">Aeternity (13)</a></li><li class="list-inline-item" data-v-a4132618><a href="/tag/blockchain/" target="_self" class="btn mb-2 btn-primary btn-sm">Blockchain (65)</a></li><li class="list-inline-item" data-v-a4132618><a href="/tag/smart-contracts/" target="_self" class="btn mb-2 btn-primary btn-sm">Smart Contracts (22)</a></li><li class="list-inline-item" data-v-a4132618><a href="/tag/sophia-ml/" target="_self" class="btn mb-2 btn-primary btn-sm">Sophia ML (3)</a></li><li class="list-inline-item" data-v-a4132618><a href="/tag/tutorial/" target="_self" class="btn mb-2 btn-primary btn-sm">Tutorial (2)</a></li></ul></div></article></div></main></div><div class="row mt-5 p-2 newsletter" data-v-102ecac7 data-v-102ecac7><div class="img-container col-sm-3 col-12" data-v-102ecac7><img src="/assets/img/hack_newsletter.7a223066.png" alt="newsletter" width="90%" data-v-102ecac7></div><div class="col" data-v-102ecac7><h3 data-v-102ecac7>Let's build the decentralized future together!</h3><h4 data-v-102ecac7>Subscribe for updates from the blog</h4><form class="form-inline" data-v-102ecac7><fieldset class="form-group" data-v-102ecac7><!----><div tabindex="-1" role="group" class="bv-no-focus-ring"><div class="row" data-v-102ecac7><div class="mb-2 mb-md-0 col" data-v-102ecac7><label for="email" class="sr-only" data-v-102ecac7>E-mail</label><input id="email" type="text" placeholder="Your email" value="" class="mb-2 mr-sm-2 w-100 h-100 form-control" data-v-102ecac7><div aria-hidden="true" style="position:absolute;left:-5000px;" data-v-102ecac7><input type="text" name="b_2f5135b55e33a57f177a0e158_16c540b6e8" tabindex="-1" value="" data-v-102ecac7></div></div><div class="col-md-4 col-12" data-v-102ecac7><button type="submit" class="btn w-100 btn-primary" data-v-102ecac7>Subscribe</button></div></div><!----><!----><!----></div></fieldset><!----><!----><!----></form></div></div><div class="row mt-2"><div id="comments" class="comments-area col"><!----><ol class="comment-list p-0"></ol><div id="respond" class="comment-respond" data-v-783b7f72><form id="commentForm" data-v-783b7f72 data-v-783b7f72><h3 id="reply-title" data-v-783b7f72>
      Leave a Reply
      <small data-v-783b7f72><a color="primary" href="#" target="_self" class="cancel" data-v-783b7f72>Cancel reply</a></small></h3><p data-v-783b7f72>Your email address will not be published. Required fields are marked *</p><label for="comment" data-v-783b7f72>Comment</label><textarea id="comment" required="required" rows="8" wrap="soft" aria-required="true" cols="45" maxlength="65525" class="comment-textarea mb-4 form-control" data-v-783b7f72></textarea><label for="author" data-v-783b7f72>Name *</label><input id="author" type="text" required="required" aria-required="true" maxlength="245" value="" class="comment-input mb-4 form-control" data-v-783b7f72><label for="email" data-v-783b7f72>Email *</label><input id="email" type="email" required="required" aria-required="true" maxlength="100" value="" class="comment-input mb-4 form-control" data-v-783b7f72><button type="submit" class="btn btn-primary" data-v-783b7f72 data-v-783b7f72>Post Comment</button><!----><!----><!----></form></div></div></div></main><!----></div><footer class="bg-white py-5 mt-5" data-v-695cf326><div class="container" data-v-695cf326 data-v-695cf326><hr data-v-695cf326><div class="row" data-v-695cf326 data-v-695cf326><div class="col-lg" data-v-695cf326 data-v-695cf326><img src="/assets/img/hack-logo.a62cc95d.png" alt="hack-logo" width="100%" data-v-695cf326><ul class="flex-wrap" data-v-695cf326><li data-v-695cf326><a href="mailto:hello@hack.bg" title="Get in touch: hello@hack.bg" data-v-695cf326>hello@hack.bg</a></li><li data-v-695cf326><a href="tel:00359898725100" title="Call us: 00 359 898 725 100" data-v-695cf326>00 359 898 725 100</a></li><li data-v-695cf326><abbr title="We are based in Sofia, Bulgaria" data-v-695cf326>Floor 4, 47 Cherni Vrah blvd. Sofia 1407, Bulgaria</abbr></li><li data-v-695cf326><a href="//facebook.com/hackbg" target="_blank" title="hack - facebook page" data-v-695cf326><i class="fab fa-facebook" data-v-695cf326></i></a><a href="//linkedin.com/company/hackbg-blockchain-web-software-solutions" target="_blank" title="hack - linkedin company page" data-v-695cf326><i class="fab fa-linkedin" data-v-695cf326></i></a><a href="//twitter.com/hack_bg" target="_blank" title="hack - twitter company page" data-v-695cf326><i class="fab fa-twitter" data-v-695cf326></i></a><a href="//github.com/hackbg" target="_blank" title="hack - github page" data-v-695cf326><i class="fab fa-github" data-v-695cf326></i></a><a href="//gitter.im/hack-blockchain-development/lobby" target="_blank" title="hack - gitter chat" data-v-695cf326><i class="fab fa-gitter" data-v-695cf326></i></a><a href="//medium.com/hack" target="_blank" title="hack - blog on medium" data-v-695cf326><i class="fab fa-medium" data-v-695cf326></i></a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Services</h2><ul data-v-695cf326><li data-v-695cf326><a href="/dlt-blockchain-development-services/blockchain-software-development/" title="Blockchain Development services" data-v-695cf326>Blockchain Development</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/smart-contracts-development/" title="Smart contract development services" data-v-695cf326>Smart Contracts</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/smart-contract-audits/" title="Blockchain Consulting and Advisory" data-v-695cf326>Smart contract Audits</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/ico-initial-coin-offering/" title="Funrasing and crowsale" data-v-695cf326>Crowdsale</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/blockchain-consulting/" title="Blockchain Consulting and Advisory" data-v-695cf326>Consulting</a></li><li data-v-695cf326><a href="/dlt-blockchain-development-services/decentralized-applications-development/" title="Decentralized Applications Consulting and Development" data-v-695cf326>Decentralized Applications Development</a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Products</h2><ul data-v-695cf326><li data-v-695cf326><a href="//github.com/mradkov/vscode-sophia" data-v-695cf326>Sophia VSCode</a></li><li data-v-695cf326><a href="//waellet.com" data-v-695cf326>Waellet</a></li></ul></div><div class="col-lg" data-v-695cf326 data-v-695cf326><h2 class="h6 mt-4 mb-2" data-v-695cf326>Company</h2><ul data-v-695cf326><li data-v-695cf326><a href="/#clients-and-partners" title="Our clients portfolio" data-v-695cf326>Clients and partners</a></li><li data-v-695cf326><a href="/events" title="Events organized by hack" data-v-695cf326>Events</a></li><li data-v-695cf326><a href="/careers" title="Careers at hack" data-v-695cf326>Careers</a></li><li data-v-695cf326><a href="/blog" title="hack - blog" data-v-695cf326>Blog</a></li><li data-v-695cf326><a href="//github.com/hackbg/hack-media-kit/" target="_blank" title="hack media kit" data-v-695cf326>Press</a></li><li data-v-695cf326><a href="/privacy-policy/" title="hack privacy policy" data-v-695cf326>Privacy Policy</a></li></ul></div></div></div><p class="text-center" data-v-695cf326>
    ©
    <a href="https://hack.bg/" data-v-695cf326>hack.bg</a> Ltd - All rights reserved, 2016 - 2020
  </p></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"533","title":"Building Voting æpp with Sophia ML on æternity blockchain","date":"2019-01-23T20:11:11","content":"\n\u003Cp\u003ETime is passing by and we are getting more experienced in writing smart contracts with Sophia ML language on æ\u003Cg class=\"gr_ gr_8 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"8\" data-gr-id=\"8\"\u003Eternity\u003C\u002Fg\u003E blockchain.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EIn this tutorial, I&#8217;d like to share with you a simple voting decentralized \u003Cg class=\"gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"3\" data-gr-id=\"3\"\u003Eaepp\u003C\u002Fg\u003E solution that we&#8217;ve built during the æpps summit in Turkey, which I took part in.\u003C\u002Fp\u003E\n\n\n\n\u003Cdiv class=\"wp-block-image\"\u003E\u003Cfigure class=\"aligncenter\"\u003E\u003Cimg loading=\"lazy\" width=\"960\" height=\"540\" src=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2019\u002F01\u002Faepps-summit.jpg\" alt=\"\" class=\"wp-image-542\" srcset=\"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2019\u002F01\u002Faepps-summit.jpg 960w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2019\u002F01\u002Faepps-summit-300x169.jpg 300w, https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2019\u002F01\u002Faepps-summit-768x432.jpg 768w\" sizes=\"(max-width: 960px) 100vw, 960px\" \u002F\u003E\u003Cfigcaption\u003Ephoto by nikita fuchs\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThis was one of my first times interacting with Sophia ML smart contracts, and while at the æpps summit I&#8217;ve gathered some cool and enthusiastic people, and made ourselves sort of a studying group. We decided to brainstorm and learn together while developing this voting \u003Cg class=\"gr_ gr_6 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace\" id=\"6\" data-gr-id=\"6\"\u003Eaepp\u003C\u002Fg\u003E. This is the short summary of what we&#8217;ve decided our voting \u003Cg class=\"gr_ gr_7 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace\" id=\"7\" data-gr-id=\"7\"\u003Eaepp\u003C\u002Fg\u003E will be doing:\u003C\u002Fp\u003E\n\n\n\n\u003Col\u003E\u003Cli\u003EAdd candidates to vote for\u003C\u002Fli\u003E\u003Cli\u003EAllow users to give their vote for a certain candidate\u003C\u002Fli\u003E\u003Cli\u003ECount the votes that every candidate gathered\u003C\u002Fli\u003E\u003C\u002Fol\u003E\n\n\n\n\u003Cp class=\"note\"\u003EYou can \u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep\" id=\"5\" data-gr-id=\"5\"\u003Etry\u003C\u002Fg\u003E push the \u003Cg class=\"gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"3\" data-gr-id=\"3\"\u003Eaepp&#8217;s\u003C\u002Fg\u003E functionalities further, with more sophisticated functions and use case, you can try doing it \u003Cg class=\"gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep\" id=\"7\" data-gr-id=\"7\"\u003Eyourself,\u003C\u002Fg\u003E \u003Cg class=\"gr_ gr_25 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace\" id=\"25\" data-gr-id=\"25\"\u003Elike\u003C\u002Fg\u003E we did. Try it &#8211; its fun.\u003C\u002Fp\u003E\n\n\n\n\u003Ch2\u003ESetting up project and development \u003Cg class=\"gr_ gr_109 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace gr-progress\" id=\"109\" data-gr-id=\"109\"\u003Eenvironment\u003C\u002Fg\u003E\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003E\u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep\" id=\"5\" data-gr-id=\"5\"\u003EFirst\u003C\u002Fg\u003E we have to initialize our project where we will write \u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace\" id=\"4\" data-gr-id=\"4\"\u003Ethe smart\u003C\u002Fg\u003E contract. In order to do that we will be using \u003Ccode\u003Eforgae\u003C\u002Fcode\u003E. Take a look at the \u003Ca href=\"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fbuild-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book\u002F\"\u003EBuild first \u003C\u002Fa\u003E\u003Cg class=\"gr_ gr_92 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"92\" data-gr-id=\"92\"\u003E\u003Ca href=\"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fbuild-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book\u002F\"\u003Eaeternity\u003C\u002Fa\u003E\u003C\u002Fg\u003E\u003Ca href=\"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fbuild-your-first-decentralized-application-aepp-on-aeternity-blockchain-sophia-smart-contract-address-book\u002F\"\u003E application with Sophia ML tutorial\u003C\u002Fa\u003E and follow the steps to initialize your project.\u003C\u002Fp\u003E\n\n\n\n\u003Ch2\u003ESmart contract\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EAs you probably already know (if you&#8217;ve followed the previous tutorial), in \u003Cg class=\"gr_ gr_3 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep\" id=\"3\" data-gr-id=\"3\"\u003ESophia\u003C\u002Fg\u003E ML we have a \u003Cstrong\u003Estate\u003C\u002Fstrong\u003E which is the place where we store data on-chain, and it is the only thing in the smart contract that can be mutated (overwritten).\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EThe first thing we do is to define our variables and types that we are going to use in the smart contract. And \u003Cg class=\"gr_ gr_217 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"217\" data-gr-id=\"217\"\u003Ethe \u003C\u002Fg\u003E\u003Ccode\u003Einit()\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_217 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"217\" data-gr-id=\"217\"\u003E function\u003C\u002Fg\u003E which is the constructor basically, if we compare this to a Solidity smart contract.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Econtract Vote =\n   type candidate = address\n   type votes = list(address)\n\n   record state = \n      { vote : map(candidate, votes) }\n\n   public function init() : state = \n      { vote = { } }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EWe are defining \u003Cg class=\"gr_ gr_263 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"263\" data-gr-id=\"263\"\u003Ethe \u003C\u002Fg\u003E\u003Ccode\u003Ecandidate\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_263 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"263\" data-gr-id=\"263\"\u003E type\u003C\u002Fg\u003E as address, and votes as a \u003Cstrong\u003Elist\u003C\u002Fstrong\u003E of addresses. And the \u003Ccode\u003Estate\u003C\u002Fcode\u003E record will be storing a map (key-value-pair) of \u003Ccode\u003Ecandidate\u003C\u002Fcode\u003E to \u003Ccode\u003Evotes\u003C\u002Fcode\u003E.\u003Cbr\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Cdel\u003EStarting with the first functionality for the aepp &#8211; adding candidates:\u003C\u002Fdel\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003E\u003Cdel\u003E  public stateful function add_candidate(candidate: address) : bool =       is_candidate(candidate)       true\u003C\u002Fdel\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003E\u003Cdel\u003EWhat this does is passing the candidate to the \u003C\u002Fdel\u003E\u003Ccode\u003E\u003Cdel\u003Eis_candiate()\u003C\u002Fdel\u003E\u003C\u002Fcode\u003E\u003Cdel\u003E function &#8211; taking a candidate&#8217;s address as a parameter, checking if there is a candidate defined at with this address and saving it to the \u003C\u002Fdel\u003E\u003Cstrong\u003E\u003Cdel\u003Evotes\u003C\u002Fdel\u003E\u003C\u002Fstrong\u003E\u003Cdel\u003E mapping in the state with the initial empty list of voters if not.\u003C\u002Fdel\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Cdel\u003EHere are the helper functions we are using for this:\u003C\u002Fdel\u003E\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003E\u003Cdel\u003E   private stateful function is_candidate(candidate: address) =       let candidate_found = lookupByAddress(candidate, state.votes, { voters = [] })       if (size(candidate_found.voters) == 0)          put(state{             votes[candidate] = { voters = [] } })    private function lookupByAddress(k : address, m, v) =       switch(Map.lookup(k,m))          None =\u003E v          Some(x) =\u003E x\u003C\u002Fdel\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EWe are doing this because in Sophia ML we don&#8217;t have a default value of 0x0\u002Ffalse as in Solidity for example. So, in order for us to cast a vote, we need to first have added the candidates which we can vote for.\u003C\u002Fp\u003E\n\n\n\n\u003Cp class=\"note\"\u003EIf we don&#8217;t add the candidate first, before voting, we will hit \u003Ccode\u003Eout of gas\u003C\u002Fcode\u003E error.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ENext we create the vote function which looks like this:\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Epublic stateful function vote(vote_for: candidate) =\n      put(state{ vote[vote_for = []] @ vs = Call.caller :: vs })\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EWe access the transaction initiator&#8217;s address by the \u003Cg class=\"gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"3\" data-gr-id=\"3\"\u003Ebuilt \u003C\u002Fg\u003E\u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"4\" data-gr-id=\"4\"\u003E\u003Cg class=\"gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace\" id=\"3\" data-gr-id=\"3\"\u003Ein\u003C\u002Fg\u003E \u003C\u002Fg\u003E\u003Ccode\u003ECall.caller\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_4 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"4\" data-gr-id=\"4\"\u003E and\u003C\u002Fg\u003E prepend \u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"5\" data-gr-id=\"5\"\u003Eit \u003C\u002Fg\u003E\u003Ccode\u003E::\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"5\" data-gr-id=\"5\"\u003E to\u003C\u002Fg\u003E the current list of voters. Using this \u003Cg class=\"gr_ gr_23 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"23\" data-gr-id=\"23\"\u003Esyntx\u003C\u002Fg\u003E we \u003Cg class=\"gr_ gr_32 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace\" id=\"32\" data-gr-id=\"32\"\u003Edont\u003C\u002Fg\u003E need to worry whether the candidate was initialized or not.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003E\u003Cg class=\"gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep\" id=\"9\" data-gr-id=\"9\"\u003ELast\u003C\u002Fg\u003E thing is the get votes count function.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Epublic function count_votes(count_for : candidate) =\n      length(state.vote[count_for = []])\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EHere we are using a custom \u003Ccode\u003Elength\u003C\u002Fcode\u003E function which we define as a helper function below. Here is the code and below we can see the explanation.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Eprivate function length(l : list('a)) : int = length'(l, 0)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EThis is where things get a bit more complicated, so I will try to explain what is happening here.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003ESince in Sophia ML we don&#8217;t have \u003Ccode\u003E.count\u003C\u002Fcode\u003E or \u003Ccode\u003E.length\u003C\u002Fcode\u003E to get the list length, we need to make ourselves a helper function which will make a recursion and will iterate over the list while incrementing a counter.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EThe \u003Ccode\u003Elength\u003C\u002Fcode\u003E function is defined to accept a list \u003Cg class=\"gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"9\" data-gr-id=\"9\"\u003Eof \u003C\u002Fg\u003E\u003Ccode\u003E'a\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"9\" data-gr-id=\"9\"\u003E which\u003C\u002Fg\u003E is the convention for a generic \u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep\" id=\"5\" data-gr-id=\"5\"\u003Etype,\u003C\u002Fg\u003E and a return \u003Cg class=\"gr_ gr_11 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"11\" data-gr-id=\"11\"\u003Etype \u003C\u002Fg\u003E\u003Ccode\u003Eint\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_11 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"11\" data-gr-id=\"11\"\u003E .\u003C\u002Fg\u003E In the function&#8217;s \u003Cg class=\"gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep\" id=\"6\" data-gr-id=\"6\"\u003Ebody\u003C\u002Fg\u003E we are calling \u003Cg class=\"gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"10\" data-gr-id=\"10\"\u003Ethe \u003C\u002Fg\u003E\u003Ccode\u003Elength'\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"10\" data-gr-id=\"10\"\u003E \u003C\u002Fg\u003E\u003Cg class=\"gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep\" id=\"7\" data-gr-id=\"7\"\u003E\u003Cg class=\"gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"10\" data-gr-id=\"10\"\u003Efunction\u003C\u002Fg\u003E,\u003C\u002Fg\u003E while passing the list and an initial value for the counter.\u003C\u002Fp\u003E\n\n\n\n\u003Cpre class=\"wp-block-preformatted\"\u003E\u003Ccode\u003Eprivate function length'(l : list('a), x : int) : int =       switch(l)          [] =\u003E x          _ :: l' =\u003E length'(l', x + 1)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\n\u003Cp\u003EAnd here the magic happens, we use \u003Cg class=\"gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace\" id=\"6\" data-gr-id=\"6\"\u003Ethe \u003C\u002Fg\u003E\u003Ccode\u003Eswitch\u003C\u002Fcode\u003E\u003Cg class=\"gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace\" id=\"6\" data-gr-id=\"6\"\u003E statement\u003C\u002Fg\u003E with 2 cases \u003Ccode\u003E[] =\u003E x\u003C\u002Fcode\u003E &#8211; which returns the value of the counter and breaks the recursion if the list is empty. And \u003Ccode\u003E_ :: l' =\u003E length'(l', x+1)\u003C\u002Fcode\u003E &#8211; meaning we are using a pattern matching and we are separating the first element from the list and the remainder and then recursively passing the list&#8217;s remainder to the same \u003Cg class=\"gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep\" id=\"5\" data-gr-id=\"5\"\u003Efunction,\u003C\u002Fg\u003E while incrementing the counter.\u003C\u002Fp\u003E\n\n\n\n\u003Cp\u003EThe whole smart contract code looks like this in the end\u003C\u002Fp\u003E\n\n\n\n\u003Cfigure\u003E\u003Cscript src=\"https:\u002F\u002Fgist.github.com\u002Fmradkov\u002Fd05aeb76c59e2098d54dc900e94aaa41.js\"\u003E\u003C\u002Fscript\u003E\u003Cfigcaption\u003ESophia ML basic voting aepp\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\n\n\n\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\n\n\n\n\u003Cp\u003EIt is fairly simple to create a basic aepp on æternity blockchain using Sophia ML. In our case with the ae-vote we stumbled upon some tricky parts like the recursive iteration, we had to make above, but when you familiarize yourself with the language it is easier.\u003C\u002Fp\u003E\n\n\n\n\u003Ch3\u003EUseful links\u003C\u002Fh3\u003E\n\n\n\n\u003Cul\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmradkov\u002Fae-vote\"\u003EGithub repo of the project\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Faeternity\u002Fprotocol\u002Fblob\u002Fmaster\u002Fcontracts\u002Fsophia.md\"\u003ESophia documentation\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fdev.aepps.com\u002F\"\u003Eæternity documentation\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n","excerpt":"\u003Cp\u003ETime is passing by and we are getting more experienced in writing smart contracts with Sophia ML language on æternity [&hellip;]\u003C\u002Fp\u003E\n","link":"https:\u002F\u002Fhack.bg\u002Fblog\u002Ftutorials\u002Fbuilding-voting-aepp-with-sophia-ml-on-aeternity-blockchain\u002F","modified":"2019-01-25T13:39:50","featuredMedia":{"sourceUrl":"https:\u002F\u002Fhack.bg\u002Fwp-content\u002Fuploads\u002F2019\u002F01\u002Faepps-summit.jpg","altText":"","mimeType":"image\u002Fjpeg","mediaDetails":{"width":960,"height":540}},"categories":[{"id":"4","title":"Tutorials","path":"\u002Fcategory\u002Ftutorials\u002F","count":9},{"id":"53","title":"Tech Talks","path":"\u002Fcategory\u002Fblockchain-tech-talks\u002F","count":16}],"tags":[{"id":"22","title":"Aeternity","path":"\u002Ftag\u002Faeternity\u002F","count":13},{"id":"13","title":"Blockchain","path":"\u002Ftag\u002Fblockchain\u002F","count":65},{"id":"20","title":"Smart Contracts","path":"\u002Ftag\u002Fsmart-contracts\u002F","count":22},{"id":"74","title":"Sophia ML","path":"\u002Ftag\u002Fsophia-ml\u002F","count":3},{"id":"75","title":"Tutorial","path":"\u002Ftag\u002Ftutorial\u002F","count":2}],"author":{"name":"Milen","path":"\u002Fauthor\u002Fmilen\u002F"},"metadata":{"postAudioId":[],"mediumPost":["O:11:\"Medium_Post\":11:{s:16:\"author_image_url\";s:75:\"https:\u002F\u002Fcdn-images-1.medium.com\u002Ffit\u002Fc\u002F400\u002F400\u002F1*uTloDoy725Hwdw-PyJg0Yw.jpeg\";s:10:\"author_url\";s:26:\"https:\u002F\u002Fmedium.com\u002F@radkov\";s:11:\"byline_name\";N;s:12:\"byline_email\";N;s:10:\"cross_link\";s:3:\"yes\";s:2:\"id\";s:12:\"1fada2b1e85c\";s:21:\"follower_notification\";s:3:\"yes\";s:7:\"license\";s:19:\"all-rights-reserved\";s:14:\"publication_id\";s:12:\"6c324f156ae9\";s:6:\"status\";s:5:\"draft\";s:3:\"url\";s:39:\"https:\u002F\u002Fmedium.com\u002F@radkov\u002F1fada2b1e85c\";}"],"postViewsCount":["4338"],"rankMathFocusKeyword":["voting smart contract aeternity"],"rankMathTitle":[],"rankMathDescription":["Create a simple voting aepp (æpp) on aeternity blockchain using Sophia ML smart contract"]}}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.b7ca855b.js" defer></script><script src="/assets/js/page--src--templates--word-press-post-vue.d7ca6f50.js" defer></script>
  </body>
</html>
